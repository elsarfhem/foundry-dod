{
  "name": "Rischia",
  "type": "script",
  "author": "z3oC1uNtDP0TX1os",
  "img": "icons/svg/card-joker.svg",
  "scope": "global",
  "command": "const deck = game.cards.getName(\"DoD - lista carte\")\nconst pile = game.cards.getName(\"Mazzo\")\nconst hand = game.cards.getName(\"Mano\")\n\nconst suitToName = (suit) => {\n    switch (suit) {\n        case 'white':\n            return 'Carta Bianca';\n        case 'success':\n            return 'Carta Successo';\n        case 'issue':\n            return 'Carta Imprevisto';\n        case 'destiny':\n            return 'Carta del Destino';\n        case 'failure':\n            return 'Carta Fallimento';\n        case 'fortune':\n            return 'Carta Fortuna';\n    }\n};\n\nlet numFailure = hand.cards.filter(card => card.suit === \"failure\").length\nlet numSuccess = hand.cards.filter(card => card.suit === \"success\").length\n\nlet msg = \"\"\n\nif (pile.cards.size === 0) {\n    msg = \"Errore: non puoi rischiare se non ci sono carte nel mazzo\"\n    ui.notifications.error(msg)\n    await ChatMessage.create({\n        user: game.user._id,\n        content: msg\n    })\n    return\n}\n\nif (numSuccess !== numFailure) {\n    msg = \"Attenzione: il numero di successi e di fallimenti nella mano non sono uguali. Successi: \" + numSuccess +\n        \" - Fallimenti: \" + numFailure\n    ui.notifications.warn(msg)\n    ChatMessage.create({\n        user: game.user._id,\n        content: msg\n    })\n    return\n}\n\n(async () => {\n    let drawCard;\n    let drawCards = [];\n    let cardsHtml = \"\";\n    do {\n        [drawCard] = await hand.draw(pile, 1, {\n            how: CONST.CARD_DRAW_MODES.RANDOM,\n            chatNotification: false\n        }) || [];\n        drawCards.push(drawCard);\n        console.log(\"you draw \" + drawCard)\n    } while (drawCard && drawCard.suit !== \"success\" && drawCard.suit !== \"failure\")\n    if (drawCard) {\n        drawCards.sort((a, b) => a.suit.localeCompare(b.suit));\n        const map = new Map();\n        drawCards.forEach(card => {\n            let cardTypeNum = map.get(card.suit);\n            if (cardTypeNum > 0) {\n                map.set(card.suit, ++cardTypeNum);\n            } else {\n                map.set(card.suit, 1);\n            }\n            cardsHtml += `<img class=\"card-face\" src=\"${card.img}\" alt=\"${card.name}\" title=\"${card.name}\" style=\"max-width: 90px;margin-right: 5px;margin-bottom: 5px;\"/>`;\n        });\n        console.log('map ' + map);\n        const summary = Array.from(map).map(([suit, num]) => `<li>${suitToName(suit)}: ${num}</li>`).join('');\n\n        msg = `<h1>Hai pescato una carta ${drawCard.name} ${drawCard.suit === \"success\" ? \"La prova ha avuto successo!\" : \"La prova é fallita!\"}</h1>\n                <ul>${summary}</ul>\n               <div class=\"card-draw flexrow\">${cardsHtml}</div>`;\n    } else {\n        msg = \"Nessun successo o fallimento trovato nel mazzo! La prova non ha avuto successo né fallimento.\"\n    }\n    await ChatMessage.create({\n        user: game.user._id,\n        content: msg\n    })\n})();",
  "folder": null,
  "ownership": {
    "default": 2,
    "z3oC1uNtDP0TX1os": 3
  },
  "flags": {
    "advanced-macros": {
      "runAsGM": false,
      "runForSpecificUser": ""
    }
  },
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "coreVersion": "12.343",
    "systemId": "dod",
    "systemVersion": "0.1.0",
    "createdTime": 1749679477790,
    "modifiedTime": 1749679477790,
    "lastModifiedBy": "z3oC1uNtDP0TX1os"
  },
  "_id": "TTnzkPf1V6mRGJUh",
  "sort": 0,
  "_key": "!macros!TTnzkPf1V6mRGJUh"
}
